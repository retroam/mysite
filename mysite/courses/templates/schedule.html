{% extends "base.html" %}

{% load markdown typogrify %}

{% block title %}: Schedule{% endblock %}

{% comment %}
{% block css %}
<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1/themes/blitzer/jquery-ui.css" type="text/css" media="screen"/>
{% endblock %}
{% endcomment %}

{% block content %}
<p><strong>This schedule is still in flux.</strong> Specifically, the parts in <span class="tentative">gray</span> are subject to change.</p>
<div id="accordion">
{% for entry in schedule %}
<h3{% if entry.next %} id="next"{% endif %}>
{% if entry.is_holiday %}
{% with entry as holiday %}
  <!--<a href="#">-->
    <span class="date">{{ holiday.date|date:"F j" }}</span><br/>
    <span class="title">{{ holiday.name }}</span>
  <!--</a>-->
</h3>
<div>
  <p>No class.</p>
</div>
{% endwith %}
{% else %}
{% with entry as meeting %}
  <!--<a href="#">-->
    <span class="date">{{ meeting.date|date:"F j" }}</span><br/>
    <span class="title">{{ meeting.title|typogrify }}</span>
  <!--</a>-->
</h3>
<div class="meeting{% if meeting.is_tentative %} tentative{% endif %}">
  {% filter typogrify %}
  {% if meeting.assignment_due %}
  <p class="assignment-due">
    Assignment #{{  meeting.assignment_due.number }}
    {% if meeting.assignment_due.is_handed_out %}
    <a href="{{ meeting.assignment_due.get_absolute_url }}">
      {{ meeting.assignment_due.title }}
    </a>
    {% endif %}
    due
  </p>
  {% endif %}
  <div class="description">{{ meeting.description|markdown }}</div>
  {% if meeting.has_readings %}
  <p>To read <strong>before</strong> this class:</p>
  <ol class="readings">
    {% for assigned in meeting.reading_assignments.all %}
    <li class="reading">
      <p>
        {{ assigned.reading.as_html }}
        {% if assigned.reading.url %}
        <a href="{{ assigned.reading.url }}">Link</a>
        {% endif %}
        {% if assigned.reading.file %}
          {% if user.is_authenticated %}
            {% if user_is_authorized %}
              <a href="{{ assigned.reading.file.url }}">PDF</a>
            {% endif %}
          {% else %}
          <a href="{% url django.contrib.auth.views.login %}?next={{ assigned.reading.file.url }}">
Log in</a> to download this reading.
          {% endif %}
        {% endif %}
      </p>
      <div class="description">{{ assigned.reading.description|markdown }}</div>
      {% if user.is_authenticated %}
        {% if user == assigned.discussion_leader %}
        <div><a href="{{ assigned.get_absolute_url  }}">Post discussion questions</a> for this reading.</div>
        {% else %}
          {% if user_is_authorized and assigned.discussion_questions_posted %}
          <div><a href="{{ assigned.get_absolute_url  }}">See discussion questions</a> for this reading.</div>
          {% endif %}
        {% endif %}
      {% else %}
      <div><a href="{% url django.contrib.auth.views.login %}?next={{ assigned.get_absolute_url }}">
Log in</a> to see or post discussion questions for this reading.</div>
      {% endif %}
    </li>
    {% endfor %}
  </ol>
  {% endif %}
  {% endfilter %}
</div>
{% endwith %}
{% endif %}
{% endfor %}
</div>
{% endblock %}

{% comment %}
{% block js %}
<script type="text/javascript" src="/media/js/schedule.js"></script>
{% endblock %}
{% endcomment %}